import path from "node:path";
import fsp from "node:fs/promises";
import { loadTheme } from "shiki";

const dirname = path.dirname(new URL(import.meta.url).pathname);
const THEME_DIR = path.resolve(dirname, "..", "workers");
const THEME_PATH = path.join(THEME_DIR, "base16.json");
const OUTPUT_PATH = path.join(THEME_DIR, "shiki-theme.js");

main();

async function main() {
  let theme = await loadTheme(THEME_PATH);
  let themeString = JSON.stringify(theme, null, 2);
  let output = `/**
 * This theme is generated by running \`node scripts/generate-shiki-theme.mjs\`.
 * It should be checked into Git as it is not run as part of the build. It *could*
 * be, but this gives us some flexibility to start with a VS Code them and then
 * tweak output for our needs without messing up the source.
 *
 * @type {import("shiki").IShikiTheme}
 */
let theme = ${themeString};
module.exports = theme;
`;
  await fsp.writeFile(OUTPUT_PATH, output);
  console.log(`Wrote ${OUTPUT_PATH}`);
}
